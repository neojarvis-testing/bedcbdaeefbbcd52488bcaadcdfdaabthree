<div class="page-content">
  <h1>Bookings Management</h1>
  <hr>

  <div class="top-container">
    <!-- <input id="searchBox" type="text" placeholder="Search by Event Name..." [(ngModel)]="searchValue"
      (input)="handleSearchChange($event)" /> -->
    <label id="filter">
      Filter by Status:
      <select [(ngModel)]="statusFilter" (change)="handleFilterChange($event)">
        <option value="All">All</option>
        <option value="Pending">Pending</option>
        <option value="Accepted">Accepted</option>
        <option value="Rejected">Rejected</option>
      </select>
    </label>
  </div>

  <table>
    <thead>
      <tr>
        <th>S.No</th>
        <th>Username</th>
        <th>Event Name</th>
        <th>Occupation</th>
        <th>Gender</th>
        <th>City</th>
        <th>Booking Date</th>
        <th>Status</th>
        <th>Additional Notes</th>
        <th>Mobile Number</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody *ngIf="filteredBookings.length > 0; else noRecords">
      <tr *ngFor="let booking of filteredBookings | slice:(page-1)*pageSize:(page*pageSize); let i = index">
        <td>{{ booking.SNo }}</td>
        <td>{{booking.User.Username}}</td>
        <td>{{ booking.ConferenceEvent.EventName }}</td>
        <td>{{ booking.Occupation }}</td>
        <td>{{ booking.Gender }}</td>
        <td>{{ booking.City }}</td>
        <td>{{ booking.BookingDate | date:'yyyy-MM-dd' }}</td>
        <td>
          <select [(ngModel)]="booking.BookingStatus" (change)="onStatusChange(booking)" [ngClass]="{
                'pending': booking.BookingStatus === 'Pending',
                'accepted': booking.BookingStatus === 'Accepted',
                'rejected': booking.BookingStatus === 'Rejected'
              }">
            <option value="Pending">Pending</option>
            <option value="Accepted">Accepted</option>
            <option value="Rejected">Rejected</option>
          </select>
        </td>
        <td>{{ booking.AdditionalNotes }}</td>
        <td>{{ booking.User.MobileNumber }}</td>
        <td>
          <button (click)="viewProof(booking.Proof)" class="proof-btn">View Proof</button>
          <button (click)="handleDeleteClick(booking)" class="delete-btn">Delete</button>
        </td>
      </tr>
    </tbody>
    <button  class="chart" (click)="navigateToChart()">View Bookings Pie Chart</button>

    <ng-template #noRecords>
      <tr>
        <td colspan="9" class="no-records-cell">Oops! No records found</td>
      </tr>
    </ng-template>
  </table>

  <!-- <div class="pagination">
      <button (click)="page = page - 1" [disabled]="page === 1">Previous</button>
      <span>Page {{ page }} of {{ Math.ceil(filteredBookings.length / pageSize) }}</span>
      <button (click)="page = page + 1" [disabled]="page >= Math.ceil(filteredBookings.length / pageSize)">Next</button>
    </div> -->
</div>

<!-- Proof Modal -->
<div *ngIf="showProofModal" class="modal-overlay">
  <div class="modal-content">
    <button id="close-modal" (click)="closeProofModal()">X</button>
    <img [src]="proofSrc" alt="Proof Document" />
  </div>
</div>

<div *ngIf="showDeletePopup" class="modal-overlay">
  <div class="modal-content">
      <p>Are you sure you want to delete this booking?</p>
      <button (click)="handleConfirmDelete()" class="yes-btn">Yes</button>
      <button (click)="closeDeletePopup()" class="no-btn">No</button>
  </div>
</div>

